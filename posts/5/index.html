
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Galoisplusplus</title>
  <meta name="author" content="Galoisplusplus">

  
  <meta name="description" content="最近在处理一个略奇怪的问题：app在某些情况下点按钮会消失后又重新出现，报bug的童鞋们把现象描述得有些扑朔迷离，因此本渣在排查问题时花了不少时间，在查了一些不相关的问题之后最后终于确定了现象和原因（详情请参见本渣另一篇博文）。本渣也发现了quickx的按钮类UIButton在实现上存在的一些问题 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://yszheda.github.io/blog/posts/5">
  <link href="/blog/favicon.png" rel="icon">
  <link href="/blog/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/blog/atom.xml" rel="alternate" title="Galoisplusplus" type="application/atom+xml">
  <script src="/blog/javascripts/modernizr-2.0.js"></script>
  <!--
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  -->
  <script src="//libs.baidu.com/jquery/1.7.2/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/blog/javascripts/octopress.js" type="text/javascript"></script>
  
<!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<!--
<link href="http://fonts.googleapis.com/css?family=Crimson+Text:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
-->

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/blog/">Galoisplusplus</a></h1>
  
    <h2>A fan of science, technology and Classical music.</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/blog/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:yszheda.github.io/blog" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/blog/">Blog</a></li>
  <li><a href="/blog/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/07/06/patch-for-quickx-button/">Quick-cocos2d-x按钮补丁</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-07-06T20:20:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近在处理一个略奇怪的问题：app在某些情况下点按钮会消失后又重新出现，报bug的童鞋们把现象描述得有些扑朔迷离，因此本渣在排查问题时花了不少时间，在查了一些不相关的问题之后最后终于确定了现象和原因（详情请参见本渣另一篇<a href="http://galoisplusplus.coding.me/blog/2015/01/04/quick-cocos2d-x-pitfalls/">博文</a>）。本渣也发现了quickx的按钮类<code>UIButton</code>在实现上存在的一些问题，与其不改动其内部实现去做个workaround，还不如根除问题。于是本渣对相关类的内部逻辑重新做了些设计和实现，相关的改动可以通过<code>patch</code>命令来采用。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/blog/2015/07/06/patch-for-quickx-button/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/06/08/auto-batch-in-cocos2d-x/">Cocos2d-x中的auto-batching</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-06-08T02:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本渣比较懒，就直接从工作邮件挑一部分放上来哈～</p>

<p>1.神马是GL calls？</p>

<p>GL calls也称batch，可以单纯理解成绘制次数，一般来说CPU向GPU发送batch会造成瓶颈，这个指标越小越好。</p>

<p>2.如何降低GL calls？</p>

<p>通常我们会在测试版的屏幕左下角看到一些指标，其中GL verts是需要绘制的总顶点数，一般是让每个batch的顶点数越多越好。cocosd-x引擎提供了auto batching的机制，在一定条件下，对于多个同一纹理（事实上是纹理、shader、blendFunc都需要一样）的<code>node</code>，只需要一次GL call。</p>

<p>3.auto batching原理？</p>

<p>引擎在绘制场景时会遍历每个<code>node</code>，调<code>node</code>的<code>draw</code>函数：以前<code>draw</code>函数会直接绘制<code>node</code>，但3.0之后的版本改为向一个叫<code>RenderQueue</code>的队列push绘制命令，并不马上渲染。在渲染时从该queue拿出命令，如果连续的命令都是纹理A，那么A只需要一个batch，但如果中间插入了一个纹理B，则无法只用一个batch。</p>

<p>例如：<code>RenderQueue</code>中是AAAAABAAAAA，则需要三个batches。</p>

<p>4.auto-batching/<code>RenderQueue</code>中连续的条件？</p>

<p><code>node</code>在向<code>RenderQueue</code> push命令时会先对子节点排序（排序按照<code>localZOrder</code>，<code>localZOrder</code>一样就比较子节点添加的顺序），排完序再依次push相应子节点的绘制命令。<code>RenderQueue</code>会根据<code>globalZOrder</code>再排一次序。所以最后<code>RenderQueue</code>中顺序是先按<code>globalZOrder</code>、再按<code>localZOrder</code>、最后按子节点添加到父节点的顺序。</p>

<p>PS. <code>node</code>默认的<code>globalZOrder</code>和<code>localZOrder</code>都为0</p>

<p>5.现有的系统如何用auto-batching？</p>

<ul>
<li><p>为同一纹理的UI元素都设同一个大于0的<code>globalZOrder</code>：可以保证一定只有一次batch。</p></li>
<li><p>为同一纹理的UI元素都设同一个大于0的<code>localZOrder</code>：推荐使用。<code>localZOrder</code>可以直接在UI编辑器里改，但有一定限制和技巧</p>

<ul>
<li><p>如果同一纹理的UI元素的parent都是同一个<code>node</code>，这种情况比较简单，直接在UI编辑器改即可（如果同一纹理的UI元素在编辑器中都放在一块添加，则也已经被auto batch了，不用改）。</p></li>
<li><p>如果同一纹理的UI元素的parent不是同一个<code>node</code>（这种情况在各处用<code>UIListView</code>的地方很常见），不一定能被auto-batch到，要具体看在<code>RenderQueue</code>里是否连续。希望cocos2d-x引擎能继续优化auto-batching机制以方便处理这一情况。</p></li>
</ul>
</li>
</ul>


<p>6.如何判读改的东西被auto-batch？</p>

<p>代码中给它设一个专有的大于0的<code>globalZOrder</code>，看看GL calls是否减少。不变则说明之前的改动已被auto batch。</p>

<h1>参考资料</h1>

<ul>
<li><p>[1]<a href="http://www.cocos2d-x.org/wiki/Cocos2d_v30_renderer_pipeline_roadmap">COCOS2D V30 RENDERER PIPELINE ROADMAP</a></p></li>
<li><p>[2]“笨木头”大神这篇讲得挺好，安利一下<a href="http://www.benmutou.com/archives/1006">Cocos2d-x Auto-batching 浅浅的”深入分析”</a></p></li>
<li><p>[3]<a href="http://blog.csdn.net/kaitiren/article/details/30478695">COCOS2DX 3.0 优化提升渲染速度 Auto-batching</a></p></li>
<li><p>[4]<a href="http://blog.csdn.net/fansongy/article/details/26968473">10行代码看自动Batch，10行代码看自动剔除</a></p></li>
<li><p>[5]<a href="http://blog.csdn.net/cloud95/article/details/40046697">cocos2dx auto culling 和 auto batching</a></p></li>
<li><p>[6]<a href="http://www.cocoachina.com/bbs/read.php?tid-200808.html">自动批处理（Auto-batching）</a></p></li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/05/01/quickx-tips/">Quick-cocos2d-x Tips</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-05-01T14:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>承接<a href="http://galoisplusplus.coding.me/blog/2015/01/04/quick-cocos2d-x-pitfalls/">上一篇</a>，这篇主要谈谈本渣在quickx用的一些脚本或自己折腾的一些定制，本文也将不时更新。</p>

<p>如无特殊说明，相关函数放在一个<code>MyPackage</code>的lua global table中：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="n">MyPackage</span> <span class="o">=</span> <span class="n">MyPackage</span> <span class="ow">or</span> <span class="p">{}</span>
</span></code></pre></td></tr></table></div></figure>




</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/blog/2015/05/01/quickx-tips/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/04/05/Natalia-Gutman-Cello-Recital/">Natalia Gutman Cello Recital</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-04-05T16:39:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>清明、复活节、巴赫、古特曼，这些竟神秘地交织在一起，让我有着一种别样的感受。这两天，魔都的天气阴冷得令人惆怅，但去听古特曼（Natalia Gutman）拉老巴赫（J.S.Bach）的全本大无（BWV1007-1012），却让我感到一种说不上来的庄严肃穆。这种朝圣般的敬意，一方面来自于巴赫这首伟大的作品：在这部作品中，巴赫以在当时还不是主要独奏乐器的低音乐器Viola da Gamba和Viola Pomposa探索了一个广阔无垠的音乐世界，后世的大无的作品还鲜有能达到相同高度者；另一方面来自于古特曼大师：与她的老师Rostropovich一样，古特曼对自己的音乐有着极高的要求——老罗曾后悔自己早年仓促录音，直到晚年才鼓起勇气录全本巴赫大无，而据说古特曼虽然多次在现场演奏这套曲目，但也因为达不到自己的要求而迟迟没留下录音（Live Classics留有她演奏第一和第三组曲的录音，这两首都是耳熟能详的「大俗曲」了）。去年我曾有幸现场聆听了古特曼拉巴赫大无第1、4、5组曲，丰富浑厚的音色和各个组曲间及组曲内部鲜明的风格给我留下了深刻的印象，也让我见识到大师是如何严格要求自己的：当时她拉难度颇高的第五组曲时出现了失误，尽管这几个错音无损于那晚她所呈现的精彩音乐，但老太太看起来仍很在意，返场时她又重新拉了第五的Sarabande，或许是为了补偿自己的失误吧。当年听完后，我对于没能听全她的巴赫大无专场颇为遗憾，没想到时隔一年又有幸赶上她再来演奏这套曲目，也算是了却一桩心愿吧。</p>

<p>这两天上交小厅台上的椅子上都放着一个靠垫，无声地提醒着人们这位大提琴家正受着背痛的折磨。其实这在去年也有些迹象了：当时我还很好奇古特曼所用的一种特别靠前的持弓方式，甚至回去后还模仿着拉小提，当时只觉得弓根那段废了，不过倒是比较省力。后来听说大师有背伤，才悟到这是她不得已用来减少动到背部力量的方式。在这两天，阿姨也几乎一直采用了这种持弓方式——去年并没有——想想便令人心疼。</p>

<p>在等待大师演奏的间隙，我默默在手机看巴赫大无的乐谱，从我最喜欢的第二开始，断断续续地看到第五的一小部分。不得不承认对于我这样的乐渣来说，阅读低音谱并不顺畅，一些地方还是脑补录音带过去的。古特曼第一晚的第3、2、4组曲，有两首小调的组曲，其中第二组曲更是色彩黑暗，在麦斯基等大提琴家的弓下感情十分激烈。然而那晚的古特曼却没有丝毫的煽情，相比去年也克制许多，像是淡淡地讲了个忧伤的故事。不知为何，听完回家后我总觉得有不少「话」想一吐为快，于是我拿起小提试着视奏巴赫大无的一些舞曲，但受限于读谱的水平，拉了一些片段后只能作罢，我又心有不甘地拉了小无第二组曲的萨拉班德和恰空。</p>

<p>第二晚的第1、5、6组曲，从大调到小调再回到大调，从开头到结尾。末尾两首组曲尤其宏大，也是技巧极艰深的曲子，而古特曼终究没能避免失误。第五组曲相比去年甚至多了不少错音（不过这次在小厅，位置稍靠前看得比较清楚一些——如果我没看错的话，大师用了scordatura，把A弦调成了G，对应的指法也变了，她中间在找音准其实也可以理解）。即便如此，第五的萨拉班德还是深深打动了我。老罗曾形容第五的萨拉班德类似人的呼吸，以其内在的固定节奏永远持续下去。这段萨拉班德大师从头到尾没有用vibrato（这两晚也都用得很少），全凭她的运弓来带动音乐的进行，听来却别有一番苍凉，相比其他用vibrato用额外的力度变化的表达，这确实是大师手笔。（就像我所崇敬的书画家黄宾虹先生的渴笔焦墨，全凭行笔以求「润含春泽，干裂秋风」。）第六组曲一开头便是在不同弦上做同音反复，还有各种令人生畏的和弦（尤其是Sarabande和Gavotte，老罗认为这首组曲其实是一首只由大提琴演奏的交响乐）。古特曼的演奏也并非完美，但对此曲结构的严谨把握仍处处可见：例如这两天基本未见她加入力度上的对比，但第六的前奏曲f p做得十分突出，因为这是巴赫妻子手稿里就有的记号，老罗曾说这是为了模仿回声。</p>

<p>听完了巴赫大无，我去了大师的签名会。我带了一张Live Classics发行的卡冈（Oleg Kagan，古特曼的丈夫，曾获西贝柳斯和巴赫大赛冠军、柴赛亚军，因病43岁早逝）的巴赫小无第1、2组曲，这张录音中卡冈扎实的运弓和严谨细致（恰空里的重音、中间的那段分解和弦便是绝佳的例子）和古特曼如出一辙，加上这之间联结着卡冈、古特曼夫妇还有巴赫两套无伴奏组曲的种种关系，只是如今我们已无法现场聆听到卡冈的演奏，所以我想借机试试能否请他的夫人古特曼签字，也算是清明缅怀下这位英年早逝的小提琴家吧。只是我不确定在古特曼面前这么提起她的亡夫会不会太不合适，所以也在现场买了一张阿巴多和古特曼、MCO的舒曼大协和勃拉姆斯第一小夜曲（我一般绝少在现场买碟，因为价格比网购实在坑太多。不过话说回来，如果这场有售古特曼与小薇的贝多芬大奏，我也就不用多纠结直接入手了）。不过最后我还是鼓起勇气用结结巴巴的英语问大师能否在我这张卡冈的CD内页上签字，没想到大师竟欣然接过，还对这张录音大加赞赏，我也高兴地表示自己尤其喜欢录音里的第二组曲。更加没想到的是，大师竟然还在签名处写了「Thank you!」我一时不知道说什么好了，想来这对夫妇把自己的一生都献给了艺术和无数热爱音乐的听众，即使病魔也阻挡不了他们的热情，而作为受赠者的我何德何能，如何能接受这份感谢呢？！</p>

<p>离开音乐厅时，正淅淅沥沥地下着雨。回家的地铁已停运，我便步行回去。一路上雨忽又凶猛，忽又消寂，像极了巴赫大无第二组曲的那段前奏曲起起伏伏的旋律。我又想起古特曼晚上拉的第五组曲萨拉班德，想到这晚大师尽管竭尽全力想为听众呈现完美的音乐，但终究力不从心，无法发挥水准，以她对自己艺术的苛刻要求，这恐怕对她也是一大打击。其中苦楚与无奈，或许也全在这萨拉班德中吧。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/03/30/Julian-Rachlin-and-Leonidas-Kavakos/">Julian Rachlin and Leonidas Kavakos</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-30T23:59:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>最近在魔都演奏的小提琴家中，有两位给本渣的印象尤深：一位是拉脱维亚的拉赫林（Julian Rachlin），另一位是希腊的卡瓦科斯（Leonidas Kavakos）。</p>

<p>先说说拉赫林。听那场音乐会前本渣对他并不了解，那场音乐会也主要是冲着巴西钢琴大师Nelson Freire的舒曼钢协去的。看介绍里说他是Boris Kuschnir和Pinchas Zukerman的学生，还是与VPO合作的最年轻的独奏家（14岁，穆蒂指挥），而且同时还是位中提琴家——可能是受他老师祖克曼的影响吧。前一晚拉赫林刚和<del>余拉扬</del>余隆和SSO演奏了包括贝小协和各种小品的一整场曲目，只一天之隔便又要挑战柴小协（Tchaikovsky: Violin Concerto in D major, Op. 35）。就本渣去听的那晚来说，拉赫林的表现确实让人眼前一亮。不知道是不是本渣很久没听柴小协了，个人感觉拉赫林的诠释有不少新意，例如一些经常被处理成non legato/staccato的地方反而使用legato，还有许多看似不起眼的地方他用了各种花样的spiccato。原本他用的华彩的版本并不算难（基本是老柴原版），没有很复杂的经过句，但被他处理过后也十分出彩了。拉赫林技巧相当牛逼，本渣看他第一乐章那些spiccato时常常感叹「卧槽这也能跳？！」在他狂飙起来的时候完全能带动观众的情绪——尽管SSO不像LePO、身怀撼地神功和无棒太极神技的余拉扬更非Mravinsky。最后拉赫林加演伊萨伊小无的第三奏鸣曲（Ysaye: Sonata for Solo Violin No.3 in D minor, Ballade）也大展功力，无可挑剔。</p>

<p>再说说卡瓦科斯。本渣以前就觉得卡瓦科斯有点像西盖蒂大师，这次听完现场觉得更像了：一是二者对曲目风格和内容的把握精准，也着重于挖掘内在，但往坏的讲就是书匠气，在大众听来比较无趣（当时坐我旁边的观众就昏昏欲睡）；二是两人的技术虽然都全面，足以对付那些困难乐句——Szigeti是比利时炫技派Hubay的学生，年轻时拉了不少炫技小品；卡瓦科斯更是西贝柳斯、帕格尼尼、印第安纳波里斯大赛“三冠王” ——但都不算完美，姿势都像是挤电话亭里拉琴，运弓有些毛糙，音色也不纯——个人猜这跟僵硬的姿势有点关系，卡瓦科斯在拉长弓弱奏时弓子倾斜且发抖，而且这个问题在大部分曲目都或多或少出现了，很难让人相信是有意的设计。卡瓦科斯上半场的D574（Schubert: Violin Sonata in A major, D574, Grand Duo）和贝十小奏（Beethoven: Sonata for Violin and Piano No.10 in G, Op.96）演奏得克制而不滥情，当某个主题重现时，卡瓦科斯也不会为了吸引观众而做夸张的变化。下半场“无事生非”组曲（Korngold: Much Ado About Nothing, Op. 11）和理查斯特劳斯小奏（Richard Strauss: Violin Sonata In E Flat Major, Op.18）明显加强了戏剧化的音乐表现，vibrato幅度也变大了，足见这位小提琴家如何根据曲风的不同来调整自己的演奏，只是个人觉得卡瓦科斯的演奏还是相对缺乏能让观众共鸣的热情。
最后他encore了三首，前两首都是克莱斯勒改编的西班牙舞曲，第一首选自法雅的“人生苦短”（Danse Espagnole from Falla&rsquo;s &lsquo;La Vida Breve'），卡瓦科斯基本没运用弹性速度，听起来略呆；第二首格拉纳多斯的西班牙舞曲（Granados: Spanish Dance in E minor, Op.37 No.5）就好些了。最后一首encore当时觉得耳熟，但是没想起来是什么曲子，后来才知道是Edwin Grasse的Wellenspiel(Waves at Play)，这首曲子海菲兹曾改编并演奏过。卡瓦科斯演奏得四平八稳，相比起海菲兹和帕尔曼的版本还是缺乏亮点——不过也不必有如此苛刻要求，听了我以前蛮喜欢的小提琴家Joshua Bell的演奏觉得卡瓦科斯已经够好了。</p>

<p>在小提琴天才层出不穷的今天，原本在上世纪只属于极少数大师的高超技巧现在已不鲜见。本渣就曾现场听过20岁的日本小提琴家三浦文彰的演奏：作为一位拿奖拿到手软的少年，他的技术实力对付维尼亚夫斯基、拉威尔等炫技曲目已绰绰有余；然而他的演奏却中规中矩，感觉听不出什么灵气，大部分是钢伴Itamar Golan（这位钢琴家也和拉赫林合作，本渣第一回现场看他演奏还是在Ivry Gitlis的一场音乐会上，当时他为文格洛夫和诹访内晶子伴奏，并和阿格里奇四手联弹拉威尔的“鹅妈妈”组曲）来带动音乐的进行以及加入处理的变化，这实在是遗憾（不过本渣还是看好这位少年以后的发展的，毕竟他当时只有20岁）。在现代演奏充斥着技巧至上主义的背景下，像拉赫林和卡瓦科斯两位风格迥异然皆音乐至上的演奏家实为难得。出于音乐表现的需要，两人都敢于在演奏中冒风险——只不过二者的风险不同，前者的风险主要是技术层面的，后者则是考验听者对成熟艺术的接受度。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/03/26/Elisabeth-Leonskaja-Piano-Recital/">Elisabeth Leonskaja Piano Recital</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-03-26T23:59:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>有一类钢琴家，她们不靠颜值吸引眼球，也无须“男神女神”般的商业炒作来骗取观众；她们的演奏，毫无多余而夸张的动作来满足马戏团爱好者的猎奇心，也没有唯专业人士方能揭开其神秘面纱的标新立异的风格（例如Pogorelich、例如Afanassiev——当然后者我尚未真正现场听过）。她们低调内敛，但一旦在钢琴面前弹奏，她们便俨然成了能勾走观众灵魂的魔术师，举手投足间仿佛成为了音乐的化身，连最普通的观众——例如对钢琴演奏一窍不通的我，我既不懂Pogorelich的踏板“微控”，也不懂Afanassiev的“解剖术”——也心醉神迷、难以忘怀。
这一类大师的现场音乐会，我去年有幸遇上了一次，那便是我极赞赏的小薇（Elisso Wirssaladze），而今年又有幸遇上了另一位俄派钢琴家莱昂斯卡娅（Elisabeth Leonskaja，以下就以乐迷们对她的昵称“莱姨”来称呼她吧XD）。</p>

<!--
不仅有着高超的技巧及独特的风格，而且她们的音乐非独专业人士方能品味其妙（例如Pogorelich），就连一般的听众也能深受感染、难以忘怀。这一类大师的现场音乐会，我去年有幸遇上了一次，那便是小薇（Elisso Wirssaladze），而今年又有幸遇上了另一位俄派钢琴家莱昂斯卡娅（Elisabeth Leonskaja）。
-->


<p>这位奥地利籍犹太钢琴家与小薇还是同乡，也出生于格鲁吉亚第比利斯。然而不同于小薇的老涅高兹学派，她师从的是俄派的另一位巨头伊贡诺夫的学生Yakov Milstein。与不少钢琴家一样，她也参加了不少比赛，并取得优异成绩：在埃奈斯库大赛夺冠，隆-蒂博大赛中取得第三名，伊利莎白大赛取得第九名。莱姨还是小提琴家卡冈（Oleg Kagan，这位并非大家熟悉的老柯岗Leonid Kogan，老柯岗的妻子其实是大家熟悉的吉列尔斯的妹妹小提琴家Elizabeth Gilels——这里碎碎念一会，这位小提琴家现在默默无闻，但她也曾在伊萨伊大赛中获得第三名，第一名自然是老奥胖David Oistrakh，第二名是Boris Goldstein（海菲兹曾大为赞赏这位大神的天分，他也曾在那届传奇般的内弗打败老奥胖的维尼亚夫斯基大赛中获得第四名），足见其实力）的第一任妻子（后一位就是小薇的好闺蜜古特曼了），也因为卡冈认识了里秃，并和里秃录过格里格改编的莫扎特双钢奏。作为伊贡诺夫学派的传人，莱姨的演奏承传了该派优美的音色和歌唱性，我非常喜欢她在录音中呈现的那种多层次的力度变化，这种力度变化即便是在弱奏也极为丰富，莱姨的舒伯特即兴曲D935、D899和三首勃钢奏也是我钟爱的版本——她的老肖和老柴据说也很出色，不过我还未曾仔细听过。
此次是莱姨首次来魔都，十分难得，尽管中间略有些曲折，但我最后还是赶上了，而莱姨的这场音乐会也是我来魔都以来最受感染的一次。</p>

<p>一开始莱姨的“暴风雨”其实便已展现了大开大合的功力，只是比起我钟爱的奇科里尼版（我甚至觉得奇科里尼在第三乐章加的装饰音都妙不可言，说起奇老爷子，据说原本今年要来我朝的，可惜他竟年初仙逝，令人扼腕）还有差距。 但当莱姨弹D760时，我彻底着了迷。之前恰好在刷小薇那张LCL372，个人觉得这张录音里D935很一般，倒是D760还不错，故而还经常翻出来听的，但听了莱姨的现场，不得不承认她的“流浪者”和莱姨相比还是处理得仓促而剧烈、偏离舒伯特风格了。 下半场的李斯特和勃拉姆斯真是全场高能。李斯特《旅行者岁月-意大利》中共有以彼得拉克十四行诗为题材的作品三首，莱姨选的104算是其中最为大众所熟知的曲子了，小薇的版本（收于LCL306）我恰好也听过，两位俄派大师都弹得十分迷人。至于勃拉姆斯第三钢奏，莱姨的勃钢奏录音原本就享有盛誉，这次弹得要比录音自由一些。 当然，由于身体原因，晚上莱姨是出现了一些错音，但是相比今晚精彩的音乐，这几个错音又算什么？ 更何况最后莱姨还慷慨地为观众献上了四首encore！ 一开始是德彪西前奏曲的“焰火”，尽显其精湛技术。而后莱姨返场带着谱子，弹了一首中国曲子《牧童短笛》。就在此曲曲终观众鼓掌之时，莱姨止住了掌声，紧接着encore了拉赫前奏曲Op.32第12——我听此曲还从未有像那晚一般的触动。最后就在不少人准备退场之时，莱姨又为大家献上一首肖邦的夜曲。真是令人难忘的一夜。</p>

<p>除了音乐，大师的人格素养也极令人感动：本场莱姨是抱病来演的，中间数次强忍咳嗽，有几次实在忍不住才咳了出来——与现场某些观众的表现真是高下立判。
最后安可了四首后，莱姨还不辞辛劳为乐迷签名——据说有位莱姨粉带了二十多张CD去，请莱姨挑一张签，结果莱姨全都签了&hellip;
（这里顺道吐槽下现场卖碟的真心宰人，Apex那些中价碟一般是40-60的，居然能卖100-200&hellip;还好我带了一张舒伯特晚期钢奏D958和960（当然我还不是莱姨脑残粉——至少之前不是——没买Teldec原版，也是买这个系列的XD）。）
原本我以为莱姨这是出于一种职业素质，但后来看了上交双月刊《音乐地图》的一篇文章<a href="http://www.douban.com/note/491709822/">《“阿姨”莱昂斯卡娅》</a>，才知道莱姨在生活中就是这么无私，顿时又生一层敬意。
（顺道一提，这次上交免费的节目单写得真好，中英文我都读了，寥寥几语便点出了曲目间各种内在关联，相比某些非免费节目单上拼凑来的介绍不知道高到哪里去了，我也是后来看微博才知道，原来那位署名「迷离」的撰稿人就是该文的作者XD）</p>

<!--
PSS.由于魔都同时还有巴塞尔交响和法佐赛伊,来听莱姨的不算太多,但赶脚这场观众总体素质算是来魔都最好的一次,莱姨加演时还有一位坐第一排的乐迷上前献花,莱姨也很感动
-->


<p>著名俄派大师“索神”（这里并非指Sokolov，而是Sofronitsky）曾说：“真正伟大的艺术应该是被包上七层坚硬地壳下炽热的、沸腾的熔岩”。能称得上如此评价者，小薇如是，莱姨亦如是。希望两位大师健康长寿，将她们伟大的艺术和爱带给更多的爱乐者，温暖他们的心。</p>

<h2>更正</h2>

<p>查了下资料，是我记忆错误，1937年伊萨伊大赛的第二名并非Boris Goldstein，而是卡尔-弗莱什的学生Ricardo Odnoposoff，他也是前六名获奖者中唯一的非苏联人：Goldstein其实还是第四名，第五名是Marina Kozolupova，第六名是Mikhail Fichtenholz。如此看来，Elizabeth Gilels作为仅次于老奥胖的苏联获奖者，实力不容小觑。可惜她的录音太少了，包括我在内的大部分人只熟悉她丈夫和哥哥。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/02/01/label-typewriting-effect/">Cocos2d-x实现打字特效</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-02-01T02:36:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>这次分享一个在cocos2d-x中实现打字特效的小功能。</p>

<p>首先，cocos2d-x中label默认是utf8编码，quickx提供了一个<code>string.utf8len</code>接口，这里再加一个截取子字符串的函数：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="k">function</span> <span class="nf">utf8str</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">start</span><span class="p">,</span> <span class="n">num</span><span class="p">)</span>
</span><span class='line'>    <span class="kd">local</span> <span class="k">function</span> <span class="nf">utf8CharSize</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="n">char</span> <span class="k">then</span>
</span><span class='line'>            <span class="k">return</span> <span class="mi">0</span>
</span><span class='line'>        <span class="k">elseif</span> <span class="n">char</span> <span class="o">&gt;</span> <span class="mi">240</span> <span class="k">then</span>
</span><span class='line'>            <span class="k">return</span> <span class="mi">4</span>
</span><span class='line'>        <span class="k">elseif</span> <span class="n">char</span> <span class="o">&gt;</span> <span class="mi">225</span> <span class="k">then</span>
</span><span class='line'>            <span class="k">return</span> <span class="mi">3</span>
</span><span class='line'>        <span class="k">elseif</span> <span class="n">char</span> <span class="o">&gt;</span> <span class="mi">192</span> <span class="k">then</span>
</span><span class='line'>            <span class="k">return</span> <span class="mi">2</span>
</span><span class='line'>        <span class="k">else</span>
</span><span class='line'>            <span class="k">return</span> <span class="mi">1</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="kd">local</span> <span class="n">startIdx</span> <span class="o">=</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">while</span> <span class="n">start</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">do</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">char</span> <span class="o">=</span> <span class="nb">string.byte</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">startIdx</span><span class="p">)</span>
</span><span class='line'>        <span class="n">startIdx</span> <span class="o">=</span> <span class="n">startIdx</span> <span class="o">+</span> <span class="n">utf8CharSize</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
</span><span class='line'>        <span class="n">start</span> <span class="o">=</span> <span class="n">start</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="kd">local</span> <span class="n">endIdx</span> <span class="o">=</span> <span class="n">startIdx</span>
</span><span class='line'>    <span class="k">while</span> <span class="n">num</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="k">do</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">endIdx</span> <span class="o">&gt;</span> <span class="o">#</span><span class="n">str</span> <span class="k">then</span>
</span><span class='line'>            <span class="n">endIdx</span> <span class="o">=</span> <span class="o">#</span><span class="n">str</span>
</span><span class='line'>            <span class="k">break</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">char</span> <span class="o">=</span> <span class="nb">string.byte</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span>
</span><span class='line'>        <span class="n">endIdx</span> <span class="o">=</span> <span class="n">endIdx</span> <span class="o">+</span> <span class="n">utf8CharSize</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
</span><span class='line'>        <span class="n">num</span> <span class="o">=</span> <span class="n">num</span> <span class="o">-</span> <span class="mi">1</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">str</span><span class="p">:</span><span class="n">sub</span><span class="p">(</span><span class="n">startIdx</span><span class="p">,</span> <span class="n">endIdx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>第一种实现方式是一开始把每个字符scale到0，延迟一定时间后再scale到原大小：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="c1">-- textDelayTime为每个字显示的延迟时间</span>
</span><span class='line'><span class="k">function</span> <span class="nf">typewriting</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">textDelayTime</span><span class="p">)</span>
</span><span class='line'>    <span class="n">string</span> <span class="o">=</span> <span class="n">label</span><span class="p">:</span><span class="n">getString</span><span class="p">()</span>
</span><span class='line'>  <span class="c1">-- 这里考虑了label可能有换行的情况</span>
</span><span class='line'>    <span class="kd">local</span> <span class="n">totalLen</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">utf8len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="n">label</span><span class="p">:</span><span class="n">getStringNumLines</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">totalLen</span> <span class="k">do</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">sprite</span> <span class="o">=</span> <span class="n">label</span><span class="p">:</span><span class="n">getLetter</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">sprite</span> <span class="k">then</span>
</span><span class='line'>            <span class="n">sprite</span><span class="p">:</span><span class="n">setScale</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="kd">local</span> <span class="n">textAppear</span> <span class="o">=</span> <span class="n">cc</span><span class="p">.</span><span class="n">ScaleTo</span><span class="p">:</span><span class="n">create</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">totalLen</span> <span class="k">do</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">textDelay</span> <span class="o">=</span> <span class="n">cc</span><span class="p">.</span><span class="n">DelayTime</span><span class="p">:</span><span class="n">create</span><span class="p">(</span><span class="n">textDelayTime</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">textActionSeq</span> <span class="o">=</span> <span class="n">cc</span><span class="p">.</span><span class="n">Sequence</span><span class="p">:</span><span class="n">create</span><span class="p">(</span><span class="n">textDelay</span><span class="p">,</span> <span class="n">textAppear</span><span class="p">)</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">sprite</span> <span class="o">=</span> <span class="n">label</span><span class="p">:</span><span class="n">getLetter</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">sprite</span> <span class="k">then</span>
</span><span class='line'>            <span class="n">sprite</span><span class="p">:</span><span class="n">runAction</span><span class="p">(</span><span class="n">textActionSeq</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>这种实现的效果有跳入感，换一种方式，用visibility来控制：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="c1">-- textDelayTime为每个字显示的延迟时间</span>
</span><span class='line'><span class="k">function</span> <span class="nf">typewriting</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">textDelayTime</span><span class="p">)</span>
</span><span class='line'>    <span class="n">string</span> <span class="o">=</span> <span class="n">label</span><span class="p">:</span><span class="n">getString</span><span class="p">()</span>
</span><span class='line'>  <span class="c1">-- 这里考虑了label可能有换行的情况</span>
</span><span class='line'>    <span class="kd">local</span> <span class="n">totalLen</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">utf8len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="n">label</span><span class="p">:</span><span class="n">getStringNumLines</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">totalLen</span> <span class="k">do</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">sprite</span> <span class="o">=</span> <span class="n">label</span><span class="p">:</span><span class="n">getLetter</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">sprite</span> <span class="k">then</span>
</span><span class='line'>            <span class="n">sprite</span><span class="p">:</span><span class="n">setVisible</span><span class="p">(</span><span class="kc">false</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="kd">local</span> <span class="n">textAppear</span> <span class="o">=</span> <span class="n">cc</span><span class="p">.</span><span class="n">Show</span><span class="p">:</span><span class="n">create</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">totalLen</span> <span class="k">do</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">textDelay</span> <span class="o">=</span> <span class="n">cc</span><span class="p">.</span><span class="n">DelayTime</span><span class="p">:</span><span class="n">create</span><span class="p">(</span><span class="n">textDelayTime</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">textActionSeq</span> <span class="o">=</span> <span class="n">cc</span><span class="p">.</span><span class="n">Sequence</span><span class="p">:</span><span class="n">create</span><span class="p">(</span><span class="n">textDelay</span><span class="p">,</span> <span class="n">textAppear</span><span class="p">)</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">sprite</span> <span class="o">=</span> <span class="n">label</span><span class="p">:</span><span class="n">getLetter</span><span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">sprite</span> <span class="k">then</span>
</span><span class='line'>            <span class="n">sprite</span><span class="p">:</span><span class="n">runAction</span><span class="p">(</span><span class="n">textActionSeq</span><span class="p">)</span>
</span><span class='line'>        <span class="k">end</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>


<p>这种效果也没好多少，最后本渣换了一种思路，不按一个字一个字来runAction了，改为把label作为整体来runAction，在action中去setString，这种方式的效果好多了：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
</pre></td><td class='code'><pre><code class='lua'><span class='line'><span class="c1">-- textDelayTime为每个字显示的延迟时间</span>
</span><span class='line'><span class="k">function</span> <span class="nf">typewriting</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">textDelayTime</span><span class="p">)</span>
</span><span class='line'>    <span class="n">string</span> <span class="o">=</span> <span class="n">label</span><span class="p">:</span><span class="n">getString</span><span class="p">()</span>
</span><span class='line'>  <span class="c1">-- 这里考虑了label可能有换行的情况</span>
</span><span class='line'>    <span class="kd">local</span> <span class="n">totalLen</span> <span class="o">=</span> <span class="n">string</span><span class="p">.</span><span class="n">utf8len</span><span class="p">(</span><span class="n">string</span><span class="p">)</span> <span class="o">+</span> <span class="n">label</span><span class="p">:</span><span class="n">getStringNumLines</span><span class="p">()</span>
</span><span class='line'>  <span class="n">label</span><span class="p">:</span><span class="n">setString</span><span class="p">(</span><span class="s2">&quot;</span><span class="s">&quot;</span><span class="p">)</span>
</span><span class='line'>    <span class="kd">local</span> <span class="n">textActions</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">totalLen</span> <span class="k">do</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">textDelay</span> <span class="o">=</span> <span class="n">cc</span><span class="p">.</span><span class="n">DelayTime</span><span class="p">:</span><span class="n">create</span><span class="p">(</span><span class="n">textDelayTime</span><span class="p">)</span>
</span><span class='line'>        <span class="kd">local</span> <span class="n">textAppear</span> <span class="o">=</span> <span class="n">cc</span><span class="p">.</span><span class="n">CallFunc</span><span class="p">:</span><span class="n">create</span><span class="p">(</span><span class="k">function</span><span class="p">()</span>
</span><span class='line'>            <span class="n">label</span><span class="p">:</span><span class="n">setString</span><span class="p">(</span><span class="n">utf8str</span><span class="p">(</span><span class="n">string</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span><span class='line'>        <span class="k">end</span><span class="p">)</span>
</span><span class='line'>        <span class="nb">table.insert</span><span class="p">(</span><span class="n">textActions</span><span class="p">,</span> <span class="n">textDelay</span><span class="p">)</span>
</span><span class='line'>        <span class="nb">table.insert</span><span class="p">(</span><span class="n">textActions</span><span class="p">,</span> <span class="n">textAppear</span><span class="p">)</span>
</span><span class='line'>    <span class="k">end</span>
</span><span class='line'>    <span class="kd">local</span> <span class="n">textActionSeq</span> <span class="o">=</span> <span class="n">cc</span><span class="p">.</span><span class="n">Sequence</span><span class="p">:</span><span class="n">create</span><span class="p">(</span><span class="n">textActions</span><span class="p">)</span>
</span><span class='line'>    <span class="n">label</span><span class="p">:</span><span class="n">runAction</span><span class="p">(</span><span class="n">textActionSeq</span><span class="p">)</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/01/25/irregular-button-in-cocos2d-x-v3-2/">Cocos2d-x V3.x不规则按钮-续篇</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-25T01:33:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>之前曾经在<a href="http://galoisplusplus.coding.me/blog/2014/10/31/irregular-button-in-cocos2d-x-v3/">cocos2d-x V3.x不规则按钮</a>探讨过在cocos2d-x 3.x版本实现不规则按钮的方法，后来本渣又琢磨了下仿照RenderTexture类调用OpenGL ES API来获取图片像素信息的方式。这种方式由于按钮图片的Texture已在内存中，且不需要解析图片文件格式，因此相比之前用Image::initWithImageFile还是要快一些的。</p>

<p>重写的<code>loadNormalTransparentInfo</code>函数如下：</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/blog/2015/01/25/irregular-button-in-cocos2d-x-v3-2/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/01/17/Hilary-Hahn-Violin-Recital/">Hilary Hahn Violin Recital</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-17T23:59:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>时隔一载有余，本渣再次有机会现场听了哈恩的演奏——上回是与胖葱合作西小协，而这一次则是来东艺开独奏会。
曲目也很有意思，延续了哈恩唱片中通常把古典派浪漫派和近现代作品放一起（例如勃拉姆斯+斯特拉文斯基，西贝柳斯+勋伯格，门德尔松+老肖，老柴+哈恩在柯蒂斯音乐学院的教授Higdon）的风格。
照着原来东艺官网的排法，上半场是德彪西小奏+舒曼第一小奏，下半场是巴赫小无第三组曲（BWV1006）和27首encore的选曲——BWV1006赶脚是她特别钟爱的作品，曾在视频中看到她加演里面的曲子，本渣上回看的CBSO的那场也是加演了里面的gigue，而27首encore是她为了推广现代作品特地向当代作曲家邀约的，这半场的曲子不仅从创作时间上跨度极大（从巴洛克到当代），而且恰好也是哈恩出的第一张唱片和最新一张唱片（据说和小雅尔维合作的莫小协很快要发行了，所以27encore也很快就不是最新的了）中的曲子。</p>

<p>哈恩现场演奏的曲目却是另外的顺序，上下半场对调，27首encore选曲不仅变成了第一套曲目：</p>

<p>1.Valentin Silvestrov的Two Pieces</p>

<p>2.Paul Moravec的Blue Violin</p>

<p>3.林品晶的Solitude d'automne</p>

<p>4.佐藤聪明的Bifu</p>

<p>而且还有两首选曲穿插在下半场的德彪西和舒曼作品之后：大岛满的《回忆》和Mar Richter的Mercy。想来哈恩这么安排很可能是为了照顾我朝听众所致（据说之前在帝都那场秩序不好，中途退场的人也多，哈恩安可了一曲便草草结束，想来若是把当代作品排最后很可能大部分人退场不回去听吧）。
不过今晚本渣最喜欢的，恰恰正是这些小曲子，尤其是《回忆》。当时本渣并没有买曲目单（后来也买不到了，今晚好多人去了哈恩的签售会），中场时为了了解这些encore曲的名字，特意拍了下东艺贴的曲目。当听完哈恩演奏《回忆》后，本渣忍不住掏出手机查了这首动人小品的名字和曲作者，原来就是大岛满老湿的这首作品。</p>

<p>与之相对的，哈恩今晚演奏的其他大作品，本渣却不太喜欢。不过与微博上一些看法相似的乐迷所说的原因相左，本渣并非觉得哈恩的巴赫演奏太冷，而且恰恰相反，本渣觉得哈恩这次的BWV1006就缺乏她以往的理性与克制，琴音也不如录音中的干净。当然细节上还是很有匠心的，例如每次段落反复都会有一些或者是把位或者是弓法或者是分句上的变化，这种新意让听众听起来毫无倦意。此外，哈恩不仅大量揉指，还大胆地运用了滑音（中场休息时与一位朋友交流，他说很喜欢今晚的小无，还有这种「浪一下」的感觉，我一时找不到词来形容哈恩今晚的演奏，最后打了个比方，说她相当于小提琴的Hewitt，朋友倒也心领神会XD）。奇怪的是，哈恩的巴赫演得「浪」，但浪漫派作品却颇为沉闷，尤其是舒曼第一小奏，第一乐章哈恩演奏得拖沓而缺乏生气。</p>

<p>音乐会结束后，哈恩的签售排着一条长队，其长度简直不下席夫安可五首那场，本渣也去拍了。上次CBSO那场，本渣没带碟又没买节目单，拿着一本搓搓的笔记本去签名会，最后也签到了，这次本渣带了一张哈恩的埃尔加小协+沃恩威廉斯《云雀飞翔》的CD，至于钢伴则只能让他签票根了。哈恩给每个人签完后名后都用中文说「谢谢」XD。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/blog/2015/01/04/quick-cocos2d-x-pitfalls/">Quick-cocos2d-x踩坑记——问题与解决方案</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2015-01-04T02:00:00+08:00" pubdate data-updated="true"></time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>本渣最近一个月来开始接触quick-cocos2d-x，用lua开发比c++要快些，但也因为quickx目前的一些坑——当然有些其实应该算是2dx引擎本身的坑——让本渣折腾了不少时间。在此做点记录，希望能让别人少走些弯路。本文将不时更新。</p>

</div>
  
  
    <footer>
      <a rel="full-article" href="/blog/blog/2015/01/04/quick-cocos2d-x-pitfalls/">Read on &rarr;</a>
    </footer>
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="6">&larr; Older</a>
    
    <a href="/blog/blog/archives">Blog Archives</a>
    
    <a class="next" href="4">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/blog/2019/04/07/macbeth-by-tang-shu-wing/">《麦克白》的布莱希特剧场实践</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2019/01/01/those-concerts-in-2018/">盘点2018年度的现场音乐会</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2018/05/22/cudaErrorCudartUnloading/">cudaErrorCudartUnloading问题排查及建议方案</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2018/01/01/those-concerts-in-2017/">盘点2017年度的现场音乐会</a>
      </li>
    
      <li class="post">
        <a href="/blog/blog/2017/11/11/Jonas-Kaufmann-recital/">Jonas Kaufmann独奏会之艺术歌曲</a>
      </li>
    
  </ul>
</section>





  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
<!--
Copyright &copy; 2020 - Galoisplusplus -
-->
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  


</body>
</html>
