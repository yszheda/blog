<!DOCTYPE html>
<html lang="zh">
        <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                        <meta name="generator" content="Pelican" />
                        <title>为cocos2d-x的TableViewCell控件添加点击及长按支持</title>
                        <link rel="stylesheet" href="http://yszheda.github.io/blog/theme/css/main.css" />
    <meta name="description" content="再次来聊一聊cocos2d-x的TableView。之前之所以用继承TableView的方式实现2D的GridView是因为用到TableView点击事件的地方涉及到全局数据的复杂处理，这 …" />
        </head>

        <body id="index" class="home">
                <header id="banner" class="body">
                        <h1><a href="http://yszheda.github.io/blog/">Galoisplusplus</a></h1>
                        <nav><ul>
                                                <li><a href="http://yszheda.github.io/blog/category/misc.html">misc</a></li>
                                                <li><a href="http://yszheda.github.io/blog/category/music.html">music</a></li>
                                                <li><a href="http://yszheda.github.io/blog/category/reading.html">reading</a></li>
                                                <li class="active"><a href="http://yszheda.github.io/blog/category/tech.html">tech</a></li>
                        </ul></nav>
                </header><!-- /#banner -->
  <section id="content" class="body">
    <article>
      <header>
        <h1 class="entry-title">
          <a href="http://yszheda.github.io/blog/2014/11/18/20141118-touchable-tableviewcell-in-cocos2d-x.html" rel="bookmark"
             title="Permalink to 为cocos2d-x的TableViewCell控件添加点击及长按支持">为cocos2d-x的TableViewCell控件添加点击及长按支持</a></h1>
      </header>

      <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-11-18T23:23:00+08:00">
                Published: 二 18 11月 2014
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="http://yszheda.github.io/blog/author/galoisplusplus.html">Galoisplusplus</a>
                </address>
        <p>In <a href="http://yszheda.github.io/blog/category/tech.html">tech</a>.</p>
<p>tags: <a href="http://yszheda.github.io/blog/tag/cocos2d-x.html">cocos2d-x</a> <a href="http://yszheda.github.io/blog/tag/cs.html">CS</a> <a href="http://yszheda.github.io/blog/tag/tech.html">tech</a> </p>        
</footer><!-- /.post-info -->        <p>再次来聊一聊cocos2d-x的<code>TableView</code>。之前之所以用继承<code>TableView</code>的方式实现2D的<code>GridView</code>是因为用到<code>TableView</code>点击事件的地方涉及到全局数据的复杂处理，这块处理放到<code>TableViewDelegate</code>类的<code>tableCellTouched</code>比较合理。但这个函数在cell被点击时都会被调用，而实际游戏里一个cell往往只有部分UI才能被点击（所以当点击事件只与这个cell的数据相关时，直接把点击事件处理放到cell内部实现才是王道），故而我们需要对cell的点击区域做进一步的限制。为此，我封装了一个<code>TableViewCell</code>的子类来实现这一功能：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nt">TouchableTableViewCell</span><span class="p">::</span><span class="nd">TouchableTableViewCell</span><span class="o">():</span>
<span class="w">    </span><span class="nt">isValidTouched_</span><span class="o">(</span><span class="nt">false</span><span class="o">),</span>
<span class="w">    </span><span class="nt">touchableNode_</span><span class="o">(</span><span class="nt">nullptr</span><span class="o">)</span>
<span class="p">{}</span>

<span class="nt">TouchableTableViewCell</span><span class="o">::~</span><span class="nt">TouchableTableViewCell</span><span class="o">()</span>
<span class="p">{}</span>

<span class="nt">bool</span><span class="w"> </span><span class="nt">TouchableTableViewCell</span><span class="p">::</span><span class="nd">init</span><span class="o">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="err">if</span><span class="w"> </span><span class="err">(!</span><span class="n">TableViewCell</span><span class="p">:</span><span class="o">:</span><span class="nf">init</span><span class="p">())</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">return</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="nt">return</span><span class="w"> </span><span class="nt">true</span><span class="o">;</span>
<span class="err">}</span>

<span class="nt">void</span><span class="w"> </span><span class="nt">TouchableTableViewCell</span><span class="p">::</span><span class="nd">initTouchListener</span><span class="o">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="err">auto</span><span class="w"> </span><span class="err">touchListener</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="n">EventListenerTouchOneByOne</span><span class="p">:</span><span class="o">:</span><span class="nf">create</span><span class="p">();</span>
<span class="w">    </span><span class="err">CC_SAFE_RETAIN(touchListener)</span><span class="p">;</span>
<span class="w">    </span><span class="err">Rect</span><span class="w"> </span><span class="err">validTouchedRect</span><span class="p">;</span>
<span class="w">    </span><span class="err">validTouchedRect.size</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">touchableNode_-&gt;getContentSize()</span><span class="p">;</span>
<span class="w">    </span><span class="err">touchListener-&gt;onTouchBegan</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="cp">[</span><span class="o">=</span><span class="cp">]</span><span class="w"> </span><span class="err">(</span><span class="n">cocos2d</span><span class="p">:</span><span class="o">:</span><span class="n">Touch</span><span class="o">*</span><span class="w"> </span><span class="n">touch</span><span class="p">,</span><span class="w"> </span><span class="n">cocos2d</span><span class="o">::</span><span class="n">Event</span><span class="o">*</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">        </span><span class="n">if</span><span class="w"> </span><span class="p">(</span><span class="n">touchableNode_</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="p">)</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="n">return</span><span class="w"> </span><span class="n">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="nt">auto</span><span class="w"> </span><span class="nt">touchLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">touch-</span><span class="o">&gt;</span><span class="nt">getLocation</span><span class="o">();</span>
<span class="w">        </span><span class="nt">auto</span><span class="w"> </span><span class="nt">localLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">touchableNode_-</span><span class="o">&gt;</span><span class="nt">convertToNodeSpace</span><span class="o">(</span><span class="nt">touchLocation</span><span class="o">);</span>
<span class="w">        </span><span class="nt">if</span><span class="w"> </span><span class="o">(</span><span class="nt">validTouchedRect</span><span class="p">.</span><span class="nc">containsPoint</span><span class="o">(</span><span class="nt">localLocation</span><span class="o">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="err">isValidTouched_</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">true</span><span class="p">;</span>
<span class="w">            </span><span class="err">return</span><span class="w"> </span><span class="err">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="err">isValidTouched_</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">false</span><span class="p">;</span>
<span class="w">            </span><span class="err">return</span><span class="w"> </span><span class="err">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span><span class="o">;</span>
<span class="w">    </span><span class="nt">touchListener-</span><span class="o">&gt;</span><span class="nt">onTouchMoved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="cp">[</span><span class="o">=</span><span class="cp">]</span><span class="w"> </span><span class="o">(</span><span class="nt">cocos2d</span><span class="p">::</span><span class="nd">Touch</span><span class="o">*</span><span class="w"> </span><span class="nt">touch</span><span class="o">,</span><span class="w"> </span><span class="nt">cocos2d</span><span class="p">::</span><span class="nd">Event</span><span class="o">*</span><span class="w"> </span><span class="nt">event</span><span class="o">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="err">auto</span><span class="w"> </span><span class="err">touchLocation</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">touch-&gt;getLocation()</span><span class="p">;</span>
<span class="w">        </span><span class="err">auto</span><span class="w"> </span><span class="err">localLocation</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">touchableNode_-&gt;convertToNodeSpace(touchLocation)</span><span class="p">;</span>
<span class="w">        </span><span class="err">if</span><span class="w"> </span><span class="err">(validTouchedRect.containsPoint(localLocation))</span><span class="w"> </span><span class="err">{</span>
<span class="w">            </span><span class="err">isValidTouched_</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="nt">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="err">isValidTouched_</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="err">}</span><span class="o">;</span>
<span class="w">    </span><span class="nt">touchListener-</span><span class="o">&gt;</span><span class="nt">onTouchEnded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">touchListener-</span><span class="o">&gt;</span><span class="nt">onTouchMoved</span><span class="o">;</span>
<span class="w">    </span><span class="nt">touchListener-</span><span class="o">&gt;</span><span class="nt">onTouchCancelled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nt">touchListener-</span><span class="o">&gt;</span><span class="nt">onTouchEnded</span><span class="o">;</span>
<span class="w">    </span><span class="nt">_eventDispatcher-</span><span class="o">&gt;</span><span class="nt">addEventListenerWithSceneGraphPriority</span><span class="o">(</span><span class="nt">touchListener</span><span class="o">,</span><span class="w"> </span><span class="nt">this</span><span class="o">);</span>
<span class="err">}</span>

<span class="nt">void</span><span class="w"> </span><span class="nt">TouchableTableViewCell</span><span class="p">::</span><span class="nd">setTouchableNode</span><span class="o">(</span><span class="nt">cocos2d</span><span class="p">::</span><span class="nd">Node</span><span class="o">*</span><span class="w"> </span><span class="nt">touchableNode</span><span class="o">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="err">touchableNode_</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">touchableNode</span><span class="p">;</span>
<span class="w">    </span><span class="err">initTouchListener()</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<p>使用时只需让实际的<code>TableViewCell</code>类继承<code>TouchableTableViewCell</code>，在<code>tableCellTouched</code>函数中判断<code>isValidTouched_</code>即可。</p>
<p>另外，有时候我们需要让<code>TableViewCell</code>响应长按事件，我在之前的<code>TouchableTableViewCell</code>类上又做了一层封装，主要使用调度器来实现长按：</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="p">::</span><span class="n">string</span><span class="w"> </span><span class="n">LongTouchableTableViewCell</span><span class="p">::</span><span class="n">SCHEDULE_KEY</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;LONG_TOUCHABLE_TABLE_VIEW_CELL&quot;</span><span class="p">;</span>
<span class="k">const</span><span class="w"> </span><span class="nb nb-Type">float</span><span class="w"> </span><span class="n">LongTouchableTableViewCell</span><span class="p">::</span><span class="n">LONG_TOUCH_INTERVAL</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">0.2</span><span class="n">f</span><span class="p">;</span>

<span class="n">LongTouchableTableViewCell</span><span class="p">::</span><span class="n">LongTouchableTableViewCell</span><span class="p">():</span>
<span class="w">    </span><span class="n">TouchableTableViewCell</span><span class="p">(),</span>
<span class="w">    </span><span class="n">isTouchHold_</span><span class="p">(</span><span class="bp">false</span><span class="p">),</span>
<span class="w">    </span><span class="n">isLongTouched_</span><span class="p">(</span><span class="bp">false</span><span class="p">),</span>
<span class="w">    </span><span class="n">longTouchedCallback_</span><span class="p">(</span><span class="n">nullptr</span><span class="p">)</span>
<span class="p">{}</span>

<span class="n">LongTouchableTableViewCell</span><span class="p">::</span><span class="o">~</span><span class="n">LongTouchableTableViewCell</span><span class="p">()</span>
<span class="p">{}</span>

<span class="nb nb-Type">bool</span><span class="w"> </span><span class="n">LongTouchableTableViewCell</span><span class="p">::</span><span class="n">init</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">TouchableTableViewCell</span><span class="p">::</span><span class="n">init</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="p">}</span>

<span class="nb nb-Type">void</span><span class="w"> </span><span class="n">LongTouchableTableViewCell</span><span class="p">::</span><span class="n">initTouchListener</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">auto</span><span class="w"> </span><span class="n">touchListener</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">EventListenerTouchOneByOne</span><span class="p">::</span><span class="n">create</span><span class="p">();</span>
<span class="w">    </span><span class="n">CC_SAFE_RETAIN</span><span class="p">(</span><span class="n">touchListener</span><span class="p">);</span>
<span class="w">    </span><span class="n">Rect</span><span class="w"> </span><span class="n">validTouchedRect</span><span class="p">;</span>
<span class="w">    </span><span class="n">validTouchedRect</span><span class="o">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touchableNode_</span><span class="o">-&gt;</span><span class="n">getContentSize</span><span class="p">();</span>
<span class="w">    </span><span class="n">touchListener</span><span class="o">-&gt;</span><span class="n">onTouchBegan</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">cocos2d</span><span class="p">::</span><span class="n">Touch</span><span class="o">*</span><span class="w"> </span><span class="n">touch</span><span class="p">,</span><span class="w"> </span><span class="n">cocos2d</span><span class="p">::</span><span class="n">Event</span><span class="o">*</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">touchableNode_</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">        </span><span class="n">auto</span><span class="w"> </span><span class="n">touchLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touch</span><span class="o">-&gt;</span><span class="n">getLocation</span><span class="p">();</span>
<span class="w">        </span><span class="n">auto</span><span class="w"> </span><span class="n">localLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touchableNode_</span><span class="o">-&gt;</span><span class="n">convertToNodeSpace</span><span class="p">(</span><span class="n">touchLocation</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">validTouchedRect</span><span class="o">.</span><span class="n">containsPoint</span><span class="p">(</span><span class="n">localLocation</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">isValidTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">            </span><span class="n">isTouchHold_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">            </span><span class="n">isLongTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>

<span class="w">            </span><span class="n">Director</span><span class="p">::</span><span class="n">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getScheduler</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">schedule</span><span class="p">([</span><span class="o">=</span><span class="p">](</span><span class="nb nb-Type">float</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">isTouchHold_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                    </span><span class="n">isLongTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">                    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">longTouchedCallback_</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">                        </span><span class="n">longTouchedCallback_</span><span class="p">();</span>
<span class="w">                    </span><span class="p">}</span>
<span class="w">                </span><span class="p">}</span>
<span class="w">                </span><span class="n">Director</span><span class="p">::</span><span class="n">getInstance</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">getScheduler</span><span class="p">()</span><span class="o">-&gt;</span><span class="n">unschedule</span><span class="p">(</span><span class="n">SCHEDULE_KEY</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">);</span>
<span class="w">            </span><span class="p">},</span><span class="w"> </span><span class="n">this</span><span class="p">,</span><span class="w"> </span><span class="n">LONG_TOUCH_INTERVAL</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mf">0.0</span><span class="n">f</span><span class="p">,</span><span class="w"> </span><span class="bp">false</span><span class="p">,</span><span class="w"> </span><span class="n">SCHEDULE_KEY</span><span class="p">);</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">isValidTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">            </span><span class="n">isTouchHold_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">            </span><span class="n">isLongTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>

<span class="w">            </span><span class="k">return</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">touchListener</span><span class="o">-&gt;</span><span class="n">onTouchMoved</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">cocos2d</span><span class="p">::</span><span class="n">Touch</span><span class="o">*</span><span class="w"> </span><span class="n">touch</span><span class="p">,</span><span class="w"> </span><span class="n">cocos2d</span><span class="p">::</span><span class="n">Event</span><span class="o">*</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">isTouchHold_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="n">isLongTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>

<span class="w">        </span><span class="n">auto</span><span class="w"> </span><span class="n">touchLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touch</span><span class="o">-&gt;</span><span class="n">getLocation</span><span class="p">();</span>
<span class="w">        </span><span class="n">auto</span><span class="w"> </span><span class="n">localLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touchableNode_</span><span class="o">-&gt;</span><span class="n">convertToNodeSpace</span><span class="p">(</span><span class="n">touchLocation</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">validTouchedRect</span><span class="o">.</span><span class="n">containsPoint</span><span class="p">(</span><span class="n">localLocation</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">isValidTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">isValidTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">touchListener</span><span class="o">-&gt;</span><span class="n">onTouchEnded</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">[</span><span class="o">=</span><span class="p">]</span><span class="w"> </span><span class="p">(</span><span class="n">cocos2d</span><span class="p">::</span><span class="n">Touch</span><span class="o">*</span><span class="w"> </span><span class="n">touch</span><span class="p">,</span><span class="w"> </span><span class="n">cocos2d</span><span class="p">::</span><span class="n">Event</span><span class="o">*</span><span class="w"> </span><span class="n">event</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">isTouchHold_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>

<span class="w">        </span><span class="n">auto</span><span class="w"> </span><span class="n">touchLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touch</span><span class="o">-&gt;</span><span class="n">getLocation</span><span class="p">();</span>
<span class="w">        </span><span class="n">auto</span><span class="w"> </span><span class="n">localLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touchableNode_</span><span class="o">-&gt;</span><span class="n">convertToNodeSpace</span><span class="p">(</span><span class="n">touchLocation</span><span class="p">);</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">validTouchedRect</span><span class="o">.</span><span class="n">containsPoint</span><span class="p">(</span><span class="n">localLocation</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">isValidTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">true</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">isValidTouched_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="bp">false</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">};</span>
<span class="w">    </span><span class="n">touchListener</span><span class="o">-&gt;</span><span class="n">onTouchCancelled</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">touchListener</span><span class="o">-&gt;</span><span class="n">onTouchEnded</span><span class="p">;</span>
<span class="w">    </span><span class="n">_eventDispatcher</span><span class="o">-&gt;</span><span class="n">addEventListenerWithSceneGraphPriority</span><span class="p">(</span><span class="n">touchListener</span><span class="p">,</span><span class="w"> </span><span class="n">this</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>

<p>完整代码详见：
<a href="https://github.com/yszheda/cocos2d-x-TouchableTableViewCell">cocos2d-x-TouchableTableViewCell</a></p>
      </div><!-- /.entry-content -->

    </article>
  </section>
                <section id="extras" class="body">
                                <div class="blogroll">
                                        <h2>links</h2>
                                        <ul>
                                                        <li><a href="http://getpelican.com/">Pelican</a></li>
                                                        <li><a href="http://python.org/">Python.org</a></li>
                                        </ul>
                                </div><!-- /.blogroll -->
                                <div class="social">
                                        <h2>social</h2>
                                        <ul>

                                                        <li><a href="https://github.com/yszheda">GitHub</a></li>
                                                        <li><a href="https://twitter.com/yszheda">Twitter</a></li>
                                        </ul>
                                </div><!-- /.social -->
                </section><!-- /#extras -->

                <footer id="contentinfo" class="body">
                        <address id="about" class="vcard body">
                                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                        </address><!-- /#about -->

                        <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
                </footer><!-- /#contentinfo -->

        </body>
</html>