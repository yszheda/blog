<!DOCTYPE html>
<html lang="zh">
        <head>
                        <meta charset="utf-8" />
                        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
                        <meta name="generator" content="Pelican" />
                        <title>cocos2d-x V3.x不规则按钮</title>
                        <link rel="stylesheet" href="../../../theme/css/main.css" />
    <meta name="description" content="cocos2d-x的按钮默认是以长方形作为点击区域的，实际使用时这确实很蛋疼。之前有大牛研究了如何获取图片的透明度实现不规则点击区域的方法，例如： cocos2d-x开发笔记：获取Sprite上某一个点的透明度，制作 …" />
        </head>

        <body id="index" class="home">
                <header id="banner" class="body">
                        <h1><a href="../../../">Galoisplusplus</a></h1>
                        <nav><ul>
                                                <li><a href="../../../category/misc.html">misc</a></li>
                                                <li><a href="../../../category/music.html">music</a></li>
                                                <li><a href="../../../category/reading.html">reading</a></li>
                                                <li class="active"><a href="../../../category/tech.html">tech</a></li>
                        </ul></nav>
                </header><!-- /#banner -->
  <section id="content" class="body">
    <article>
      <header>
        <h1 class="entry-title">
          <a href="../../../2014/10/31/20141031-irregular-button-in-cocos2d-x-v3.html" rel="bookmark"
             title="Permalink to cocos2d-x V3.x不规则按钮">cocos2d-x V3.x不规则按钮</a></h1>
      </header>

      <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2014-10-31T23:23:00+08:00">
                Published: 五 31 10月 2014
        </abbr>

                <address class="vcard author">
                        By                                 <a class="url fn" href="../../../author/galoisplusplus.html">Galoisplusplus</a>
                </address>
        <p>In <a href="../../../category/tech.html">tech</a>.</p>
<p>tags: <a href="../../../tag/cocos2d-x.html">cocos2d-x</a> <a href="../../../tag/cs.html">CS</a> <a href="../../../tag/tech.html">tech</a> <a href="../../../tag/cocos.html">cocos</a> <a href="../../../tag/cocos2d.html">cocos2d</a> <a href="../../../tag/button.html">button</a> <a href="../../../tag/widget.html">widget</a> <a href="../../../tag/irregular.html">irregular</a> <a href="../../../tag/bu-gui-ze-an-niu.html">不规则按钮</a> <a href="../../../tag/ui.html">UI</a> <a href="../../../tag/an-niu.html">按钮</a> <a href="../../../tag/opengl.html">opengl</a> <a href="../../../tag/gl.html">gl</a> <a href="../../../tag/opengl-es.html">OpenGL ES</a> <a href="../../../tag/you-xi-kai-fa.html">游戏开发</a> <a href="../../../tag/shou-you-kai-fa.html">手游开发</a> <a href="../../../tag/mobile-game.html">mobile game</a> <a href="../../../tag/game-devolopment.html">game devolopment</a> </p>        
</footer><!-- /.post-info -->        <p>cocos2d-x的按钮默认是以长方形作为点击区域的，实际使用时这确实很蛋疼。之前有大牛研究了如何获取图片的透明度实现不规则点击区域的方法，例如：</p>
<ul>
<li>
<p><a href="http://www.cnblogs.com/Androider123/p/3795050.html">cocos2d-x开发笔记：获取Sprite上某一个点的透明度，制作不规则按钮</a></p>
</li>
<li>
<p><a href="http://zengrong.net/post/2104.htm">在 cocos2d-x 中获取纹理的像素值</a></p>
</li>
</ul>
<p>可惜在cocos2d-x v3.0以上的版本，他们的方法都失效了，因此本渣也不得不自行琢磨这一块的实现。</p>
<p>之前方法的核心在于：图片每个像素点的RGBA信息被保存在Image类中，这个底层类并不会随着图片Node的创建而留在内存中（否则其内存占用量可想而知）。然而，在create出一个Sprite后，可以在内存中拿到它的Frame，再用RenderTextue重画一次拿到原始的Image，这样就可以判断图片上任意点的像素了。如果某点像素的Alpha值为0，则说明它是透明的，点击在该点是无效的。</p>
<p>这种方法是所以会失效，是因为cocos2d-x v3.0的RenderTexture是异步渲染的，导致拿到的Image并不是最后渲染的结果。本渣用了一种简单粗暴的方法，用Image类的initWithImageFile()方法去初始化Image对象，这样就确保了对象的数据是正确的。但是这种方法会有文件IO，不宜频繁调用，因此我只在一开始时创建一次，用一个bool数组保存每个像素点是否透明度为0的信息。每次触发点击事件时，就根据这个数组的值来判断点击是否有效。我把这部分逻辑封装到<code>cocos2d::ui::Button</code>的子类<code>IrregularButton</code>中，具体代码详见：
<a href="https://github.com/yszheda/cocos2d-x-irregular-button">cocos2d-x-irregular-button</a></p>
<!-- more -->

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cm">/*</span>
<span class="cm"> * =====================================================================================</span>
<span class="cm"> *</span>
<span class="cm"> *       Filename:  IrregularButton.h</span>
<span class="cm"> *</span>
<span class="cm"> *    Description:  </span>
<span class="cm"> *</span>
<span class="cm"> *        Version:  1.0</span>
<span class="cm"> *        Created:  2014/10/29</span>
<span class="cm"> *       Revision:  none</span>
<span class="cm"> *       Compiler:  gcc</span>
<span class="cm"> *</span>
<span class="cm"> *         Author:  Shuai Yuan (), </span>
<span class="cm"> *   Organization:  </span>
<span class="cm"> *</span>
<span class="cm"> * =====================================================================================</span>
<span class="cm"> */</span>
<span class="cp">#ifndef __IRREGULAR_BUTTON_H__</span>
<span class="cp">#define __IRREGULAR_BUTTON_H__ </span>

<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;cocos2d.h&quot;</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;ui/CocosGUI.h&quot;</span>

<span class="cm">/*</span>
<span class="cm"> * =====================================================================================</span>
<span class="cm"> *        Class:  IrregularButton</span>
<span class="cm"> *  Description:  </span>
<span class="cm"> * =====================================================================================</span>
<span class="cm"> */</span>
<span class="k">class</span><span class="w"> </span><span class="nc">IrregularButton</span><span class="w"> </span><span class="o">:</span><span class="w"> </span><span class="k">public</span><span class="w"> </span><span class="n">cocos2d</span><span class="o">::</span><span class="n">ui</span><span class="o">::</span><span class="n">Button</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">public</span><span class="o">:</span>
<span class="w">        </span><span class="cm">/* ====================  LIFECYCLE     ======================================= */</span>
<span class="w">        </span><span class="n">IrregularButton</span><span class="w"> </span><span class="p">();</span><span class="w">                                     </span><span class="cm">/* constructor      */</span>
<span class="w">        </span><span class="k">virtual</span><span class="w"> </span><span class="o">~</span><span class="n">IrregularButton</span><span class="w"> </span><span class="p">();</span><span class="w">                            </span><span class="cm">/* destructor       */</span>

<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">IrregularButton</span><span class="o">*</span><span class="w"> </span><span class="nf">create</span><span class="p">();</span>
<span class="w">        </span><span class="k">static</span><span class="w"> </span><span class="n">IrregularButton</span><span class="o">*</span><span class="w"> </span><span class="n">create</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">normalImage</span><span class="p">,</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">selectedImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">disableImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">cocos2d</span><span class="o">::</span><span class="n">ui</span><span class="o">::</span><span class="n">Widget</span><span class="o">::</span><span class="n">TextureResType</span><span class="w"> </span><span class="n">texType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cocos2d</span><span class="o">::</span><span class="n">ui</span><span class="o">::</span><span class="n">Widget</span><span class="o">::</span><span class="n">TextureResType</span><span class="o">::</span><span class="n">LOCAL</span><span class="p">);</span>

<span class="w">        </span><span class="cm">/* ====================  ACCESSORS     ======================================= */</span>

<span class="w">        </span><span class="cm">/* ====================  MUTATORS      ======================================= */</span>

<span class="w">        </span><span class="cm">/* ====================  OPERATORS     ======================================= */</span>

<span class="w">        </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="nf">hitTest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">cocos2d</span><span class="o">::</span><span class="n">Vec2</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pt</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">    </span><span class="k">protected</span><span class="o">:</span>
<span class="w">        </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">init</span><span class="p">()</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">        </span><span class="k">virtual</span><span class="w"> </span><span class="kt">bool</span><span class="w"> </span><span class="n">init</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">normalImage</span><span class="p">,</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">selectedImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">disableImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s">&quot;&quot;</span><span class="p">,</span>
<span class="w">                </span><span class="n">cocos2d</span><span class="o">::</span><span class="n">ui</span><span class="o">::</span><span class="n">Widget</span><span class="o">::</span><span class="n">TextureResType</span><span class="w"> </span><span class="n">texType</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">cocos2d</span><span class="o">::</span><span class="n">ui</span><span class="o">::</span><span class="n">Widget</span><span class="o">::</span><span class="n">TextureResType</span><span class="o">::</span><span class="n">LOCAL</span><span class="p">)</span><span class="w"> </span><span class="k">override</span><span class="p">;</span>
<span class="w">        </span><span class="kt">void</span><span class="w"> </span><span class="nf">loadNormalTransparentInfo</span><span class="p">();</span>
<span class="w">        </span><span class="kt">bool</span><span class="w"> </span><span class="nf">getIsTransparentAtPoint</span><span class="p">(</span><span class="n">cocos2d</span><span class="o">::</span><span class="n">Vec2</span><span class="w"> </span><span class="n">point</span><span class="p">);</span>

<span class="w">        </span><span class="cm">/* ====================  DATA MEMBERS  ======================================= */</span>

<span class="w">    </span><span class="k">private</span><span class="o">:</span>
<span class="w">        </span><span class="cm">/* ====================  DATA MEMBERS  ======================================= */</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">normalImageWidth_</span><span class="p">;</span>
<span class="w">        </span><span class="kt">int</span><span class="w"> </span><span class="n">normalImageHeight_</span><span class="p">;</span>
<span class="w">        </span><span class="kt">bool</span><span class="o">*</span><span class="w"> </span><span class="n">normalTransparent_</span><span class="p">;</span>

<span class="p">};</span><span class="w"> </span><span class="cm">/* -----  end of class IrregularButton  ----- */</span>


<span class="cp">#endif </span><span class="cm">/* __IRREGULAR_BUTTON_H__ */</span>
</code></pre></div></td></tr></table></div>

<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">  1</span>
<span class="normal">  2</span>
<span class="normal">  3</span>
<span class="normal">  4</span>
<span class="normal">  5</span>
<span class="normal">  6</span>
<span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="cm">/*</span>
<span class="cm"> * =====================================================================================</span>
<span class="cm"> *</span>
<span class="cm"> *       Filename:  IrregularButton.cpp</span>
<span class="cm"> *</span>
<span class="cm"> *    Description:  </span>
<span class="cm"> *</span>
<span class="cm"> *        Version:  1.0</span>
<span class="cm"> *        Created:  2014/10/30</span>
<span class="cm"> *       Revision:  none</span>
<span class="cm"> *       Compiler:  gcc</span>
<span class="cm"> *</span>
<span class="cm"> *         Author:  Shuai Yuan (), </span>
<span class="cm"> *   Organization:  </span>
<span class="cm"> *</span>
<span class="cm"> * =====================================================================================</span>
<span class="cm"> */</span>
<span class="cp">#include</span><span class="w"> </span><span class="cpf">&quot;IrregularButton.h&quot;</span>

<span class="n">USING_NS_CC</span><span class="p">;</span>
<span class="k">using</span><span class="w"> </span><span class="k">namespace</span><span class="w"> </span><span class="nn">ui</span><span class="p">;</span>

<span class="n">IrregularButton</span><span class="o">::</span><span class="n">IrregularButton</span><span class="p">()</span><span class="o">:</span>
<span class="w">    </span><span class="n">Button</span><span class="p">(),</span>
<span class="w">    </span><span class="n">normalTransparent_</span><span class="p">(</span><span class="k">nullptr</span><span class="p">)</span>
<span class="p">{}</span>

<span class="n">IrregularButton</span><span class="o">::~</span><span class="n">IrregularButton</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">normalTransparent_</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">IrregularButton</span><span class="o">*</span><span class="w"> </span><span class="n">IrregularButton</span><span class="o">::</span><span class="n">create</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">IrregularButton</span><span class="o">*</span><span class="w"> </span><span class="n">widget</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IrregularButton</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">widget</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">())</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">widget</span><span class="o">-&gt;</span><span class="n">autorelease</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">widget</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">CC_SAFE_DELETE</span><span class="p">(</span><span class="n">widget</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">IrregularButton</span><span class="o">*</span><span class="w"> </span><span class="n">IrregularButton</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">normalImage</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">selectedImage</span><span class="p">,</span>
<span class="w">        </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">disableImage</span><span class="p">,</span>
<span class="w">        </span><span class="n">TextureResType</span><span class="w"> </span><span class="n">texType</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">IrregularButton</span><span class="o">*</span><span class="w"> </span><span class="n">btn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">IrregularButton</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">btn</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">btn</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="n">normalImage</span><span class="p">,</span><span class="w"> </span><span class="n">selectedImage</span><span class="p">,</span><span class="w"> </span><span class="n">disableImage</span><span class="p">,</span><span class="w"> </span><span class="n">texType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">btn</span><span class="o">-&gt;</span><span class="n">autorelease</span><span class="p">();</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="n">btn</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="n">CC_SAFE_DELETE</span><span class="p">(</span><span class="n">btn</span><span class="p">);</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="k">nullptr</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">IrregularButton</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="w"> </span><span class="o">&amp;</span><span class="n">normalImage</span><span class="p">,</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">selectedImage</span><span class="w"> </span><span class="p">,</span>
<span class="w">                  </span><span class="k">const</span><span class="w"> </span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&amp;</span><span class="w"> </span><span class="n">disableImage</span><span class="p">,</span>
<span class="w">                  </span><span class="n">TextureResType</span><span class="w"> </span><span class="n">texType</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">Button</span><span class="o">::</span><span class="n">init</span><span class="p">(</span><span class="n">normalImage</span><span class="p">,</span><span class="w"> </span><span class="n">selectedImage</span><span class="p">,</span><span class="w"> </span><span class="n">disableImage</span><span class="p">,</span><span class="w"> </span><span class="n">texType</span><span class="p">))</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">ret</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="w">            </span><span class="k">break</span><span class="p">;</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
<span class="w">    </span><span class="n">loadNormalTransparentInfo</span><span class="p">();</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">ret</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">IrregularButton</span><span class="o">::</span><span class="n">init</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">Button</span><span class="o">::</span><span class="n">init</span><span class="p">())</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span><span class="w"> </span><span class="n">IrregularButton</span><span class="o">::</span><span class="n">loadNormalTransparentInfo</span><span class="p">()</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Image</span><span class="o">*</span><span class="w"> </span><span class="n">normalImage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="n">Image</span><span class="p">();</span>
<span class="w">    </span><span class="n">normalImage</span><span class="o">-&gt;</span><span class="n">initWithImageFile</span><span class="p">(</span><span class="n">_normalFileName</span><span class="p">);</span>
<span class="w">    </span><span class="n">normalImageWidth_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalImage</span><span class="o">-&gt;</span><span class="n">getWidth</span><span class="p">();</span>
<span class="w">    </span><span class="n">normalImageHeight_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalImage</span><span class="o">-&gt;</span><span class="n">getHeight</span><span class="p">();</span>

<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">dataLen</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalImage</span><span class="o">-&gt;</span><span class="n">getDataLen</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">normalTransparent_</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="k">nullptr</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">delete</span><span class="p">[]</span><span class="w"> </span><span class="n">normalTransparent_</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">auto</span><span class="w"> </span><span class="n">normalPixels</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalImage</span><span class="o">-&gt;</span><span class="n">getData</span><span class="p">();</span>
<span class="w">    </span><span class="n">normalTransparent_</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="k">new</span><span class="w"> </span><span class="kt">bool</span><span class="p">[</span><span class="n">dataLen</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="p">(</span><span class="k">sizeof</span><span class="p">(</span><span class="kt">unsigned</span><span class="w"> </span><span class="kt">char</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="p">)];</span>
<span class="w">    </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">normalImageHeight_</span><span class="p">;</span><span class="w"> </span><span class="n">i</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="k">for</span><span class="w"> </span><span class="p">(</span><span class="k">auto</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">normalImageWidth_</span><span class="p">;</span><span class="w"> </span><span class="n">j</span><span class="o">++</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">            </span><span class="n">normalTransparent_</span><span class="p">[</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">normalImageWidth_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">normalPixels</span><span class="p">[(</span><span class="n">i</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">normalImageWidth_</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">j</span><span class="p">)</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="mi">4</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">3</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">);</span>
<span class="w">        </span><span class="p">}</span>
<span class="w">    </span><span class="p">}</span>

<span class="w">    </span><span class="k">delete</span><span class="w"> </span><span class="n">normalImage</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">IrregularButton</span><span class="o">::</span><span class="n">getIsTransparentAtPoint</span><span class="p">(</span><span class="n">cocos2d</span><span class="o">::</span><span class="n">Vec2</span><span class="w"> </span><span class="n">point</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_buttonNormalRenderer</span><span class="o">-&gt;</span><span class="n">getContentSize</span><span class="p">().</span><span class="n">height</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="n">x</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">x</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">normalImageWidth_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">x</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalImageWidth_</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="kt">int</span><span class="p">)</span><span class="w"> </span><span class="n">point</span><span class="p">.</span><span class="n">y</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">y</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="n">normalImageHeight_</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
<span class="w">        </span><span class="n">y</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">normalImageHeight_</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">normalTransparent_</span><span class="p">[</span><span class="n">normalImageWidth_</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">y</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">x</span><span class="p">];</span>
<span class="p">}</span>

<span class="kt">bool</span><span class="w"> </span><span class="n">IrregularButton</span><span class="o">::</span><span class="n">hitTest</span><span class="p">(</span><span class="k">const</span><span class="w"> </span><span class="n">Vec2</span><span class="w"> </span><span class="o">&amp;</span><span class="n">pt</span><span class="p">)</span>
<span class="p">{</span>
<span class="w">    </span><span class="n">Vec2</span><span class="w"> </span><span class="n">localLocation</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_buttonNormalRenderer</span><span class="o">-&gt;</span><span class="n">convertToNodeSpace</span><span class="p">(</span><span class="n">pt</span><span class="p">);</span>
<span class="w">    </span><span class="n">Rect</span><span class="w"> </span><span class="n">validTouchedRect</span><span class="p">;</span>
<span class="w">    </span><span class="n">validTouchedRect</span><span class="p">.</span><span class="n">size</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">_buttonNormalRenderer</span><span class="o">-&gt;</span><span class="n">getContentSize</span><span class="p">();</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">validTouchedRect</span><span class="p">.</span><span class="n">containsPoint</span><span class="p">(</span><span class="n">localLocation</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">getIsTransparentAtPoint</span><span class="p">(</span><span class="n">localLocation</span><span class="p">)</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="nb">false</span><span class="p">)</span>
<span class="w">    </span><span class="p">{</span>
<span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
<span class="w">    </span><span class="p">}</span>
<span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></td></tr></table></div>
      </div><!-- /.entry-content -->

    </article>
  </section>
                <section id="extras" class="body">
                                <div class="blogroll">
                                        <h2>links</h2>
                                        <ul>
                                                        <li><a href="http://getpelican.com/">Pelican</a></li>
                                                        <li><a href="http://python.org/">Python.org</a></li>
                                        </ul>
                                </div><!-- /.blogroll -->
                                <div class="social">
                                        <h2>social</h2>
                                        <ul>

                                                        <li><a href="https://github.com/yszheda">GitHub</a></li>
                                                        <li><a href="https://twitter.com/yszheda">Twitter</a></li>
                                        </ul>
                                </div><!-- /.social -->
                </section><!-- /#extras -->

                <footer id="contentinfo" class="body">
                        <address id="about" class="vcard body">
                                Proudly powered by <a rel="nofollow" href="https://getpelican.com/">Pelican</a>, which takes great advantage of <a rel="nofollow" href="https://www.python.org/">Python</a>.
                        </address><!-- /#about -->

                        <p>The theme is by <a rel="nofollow" href="https://www.smashingmagazine.com/2009/08/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
                </footer><!-- /#contentinfo -->

        </body>
</html>